---
path: "svn-authentication-and-auto-update"
title: "SVN Authentication and Auto Update"
description: "Adding basic Apache authentication to Subversion (SVN) and auto updating files on the server (continuous integration)."
tags: 
  - "Linux"
  - "Linux & Server Admin"
  - "Media Temple"
date: "2007-11-24T17:00:00.000Z"
draft: false
category: "test"
layout: "post"
---

!http://marcgrabanski.com/img/dedicated-virtual.jpg! During the first two parts of my series on setting up a "Media Temple":http://www.mediatemple.net/go/order/?refdom=marcgrabanski.com dedicated server, I setup subversion (SVN) on apache. Now I want to show you how I setup basic authentication and a SVN hook to automatically deploy files to the server (called continuous integration). This is great because you can check in your files to SVN and see them on the server immediately. h3. Adding Basic Apache Authentication to your Subversion (SVN) Repository First lets give apache access to the SVN database (the $ symbol just means it is a shell command). \[code lang="bash"\] chmod g+s /svnroot/db \[/code\] Now create a password file with htpasswd, name the file whatever you would like. I chose to make my file hidden by adding the period before the name. \[code lang="bash"\] htpasswd -cm /etc/.htaccess yourusername \[/code\] It will prompt you for your password. Now go back to your httpd.conf and than add the last four lines below to your Location code block- we are adding to what we did in "part 2 of the media temple setup series":http://marcgrabanski.com/article/86/Installing-Subversion-on-Apache. \[code lang="xml"\] DAV svn SVNParentPath /usr/local/svn AuthType Basic AuthName "Subversion repository" AuthUserFile /etc/.htaccess require valid-user \[/code\] For security reasons, we also need to make sure and hide the .svn folders from having apache publicly display them: # Disallow browsing of Subversion working copy administrative dirs. \[code lang="xml"\] Order deny,allow Deny from all \[/code\] Restart apache and when you try to access SVN you should be prompted for authentication. Great, SVN is now secure! You can also add more security by "adding SSL to your dedicated server":http://kb.mediatemple.net/article.php?id=430 . h3. Creating a Subversion (SVN) Hook to Auto Update Your Server I want to automatically deploy my files to my httpdocs without having to manually go in and update the files. So to accomplish this you need to "create a SVN hook that runs after every commit":http://subversion.tigris.org/faq.html#website-auto-update . First, copy the post-commit template from your svnroot/hooks folder. And lets also use chmod to give the file rights to execute. \[code lang="bash"\] cd /svnroot/hooks/ cp post-commit.tmpl post-commit chmod +x post-commit \[/code\] Now we need to create a little C program. You should have "GCC":http://gcc.gnu.org/ installed. This will compile our little C program. Create a new svnupdate.c file and put this code in. Don't forget to change the directory path: @"public\_html\_directory"@ \[code lang="c"\] #include #include #include int main(void) { execl("/usr/bin/svn","svn","update","/public\_html\_direcotry/", (const char *) NULL); return(EXIT_FAILURE); } \[/code\] Complile the file with this command. It will take the whatever.c and compile it into a binary file. \[code lang="bash"\] gcc -o svnupdate svnupdate.c \[/code\] Try executing the binary to see if it works with the env command. \[code lang="bash"\] env - ./svnupdateAlright \[/code\] now copy the whatever binary into your hooks folder. And we'll also run a couple commands to give it proper priveledges: \[code lang="bash"\] cp whatever /svnroot/hooks cd /svnroot/hooks chown root:root svnupdate chmod +s svnupdate \[/code\] Then lets tell the post commit hook to run our binary file name,"svnupdate". \[code lang="bash"\] vi /svnroot/hooks/post-commit \[/code\] Inside it the post-commit hook tell it to run the binary using the absolute path: \[code lang="bash"\] /svnroot/hooks/svnupdate \[/code\] Test it out by checking in a file to subversion. It should automatically update at the directory we set in the C program.